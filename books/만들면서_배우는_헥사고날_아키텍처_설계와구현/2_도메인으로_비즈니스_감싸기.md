# 도메인 헥사곤으로 비즈니스 규칙 감싸기

- 도메인 엔티티는 비즈니스 관심사만 처리한다.

- 서술력을 높이기 위해서 객체 타입인 값 객체를 쓸 수 있다.




## 값 객체를 통한 서술력 향상

도메인에서  값 객체는 아래와 같은 특징

- **측정, 수량화, 설명** 
  - Money, Rate, CompanyName, PhoneNumber 등의 클래스는 이름만으로도 충분한 의미를 전달
- **불변성** 
  - **값 객체는 생성 후에 변경할 수 없다.** 엄격한 불변성은 현재의 값 객체가 객체 그래프를 통해 참조하는 모든 객체가 불변임을 보장해야 함.
- **개념적 전체** 
  - 100원이라는 개념을 표현하기 위해서 Money 클래스는 양(100)과 통화(원)라는 개념을 포함해야 함
- **대체성** 
  - 불변성에서 파생. 다른 값의 객체가 필요하다면 기존의 객체 상태를 변경하는 것이 아니라 완전히 새로운 객체를 생성해야 함
- **동등성(동일성 X)** 
  - 인스턴스에 상관없이 100원은 100원과 같음. 반대로 금액이 다르다면 어떤 경우에도 다른 객체로 간주되어야 함.
- **부수효과가 없음** 
  - 스스로도 불변이며 부수효과가 있는(불변이 아닌) 객체를 참조하지 않아야 함. 이 때문에 값 객체는 객체 그래프의 가장 끝단에서부터 만들어지는 경향이 있음.

이를 위해서 class, data class, typealias, value class 등을 사용해서 서술해볼 수 있다.





## 애그리게잇을 통한 일관성 보장

엔티티와 값 객체의 그룹이 함께 전체적인 개념을 설명하는 경우에는 어떻게 할까?
-> 애그리게잇을 사용해야한다.

내부의 객체들은 일관되고 격리된 방식으로 동작한다.



애그리게잇은 객체의 데이터와 동작을 조정하는 오케스트레이터이다.

그렇기에 **진입점을 정의**해야한다(**애그리게잇 루트)**

성능과 확장성 관점에서 항상 애그리게잇을 작게 유지하기 위해 노력해야한다

- 큰 애그리게잇객체는 메모리 많이 차지!

작은 애그리게잇은 애그리게잇 루트로 동작하는 엔티티와 다른 vo 를 포함한다.

서로 다른 애그리게잇이 상호작용하게 하려면 애그리게잇 루트를 사용하는 것.

따라서 **애그리게잇 루트를 통해 애그리게잇 자식 객체에 대한 변경을 수행**하고, 
애그리게잇 루트를 사용해 이러한 변경을 **지속성 시스템에 반영(commit)한다.**



## 도메인 서비스 활용

2개의 엔티티 메서드에 대해서 동작하는 서비스 클래스를 만들 수 있다. 
이는 애플리케이션 레이어가 아닌 도메인 레이어에 위치한다.

엔티티와 값 객체가 문제 영역을 필요 이상으로 많은 기능을 갖게 되는 것을 방지하기 위함이다.



## 정책 패턴과 명세 패턴을 활용한 비즈니스 규칙 처리

**객체 유효성 검증 로직은 보통 서비스 레이어에 구현**된다. 
그러나 이는 **도메인 규칙 중에도 중요도가 높은 기능이기 때문에 서비스에 추가하는 것을 지양해야한다.** 

