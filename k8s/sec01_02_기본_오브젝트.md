# K8S




## Section 1. 기초

- VM vs Container 
  - 가상 머신(VM)은 **하드웨어 가상화를 사용하여 하나 이상의 독립적인 운영 체제를 실행하는** 데 사용됩니다. 

  - 컨테이너는 **운영 체제 수준의 가상화를 사용하여 프로세스와 필요한 모든 종속성을 함께 패키징하여 실행**합니다.

- Kubernetis Overview 
  - Kubernetes는 컨테이너 오케스트레이션 시스템으로, 컨테이너화된 애플리케이션을 관리하고 배포하기 위한 플랫폼입니다. 컨테이너의 배포, 확장, 로드 밸런싱, 스케일링 및 관리를 자동화합니다.


## Section2. 기본 오브젝트

### Pod - Container, Label, NodeSchedule 

- Pod 
  - Kubernetes에서 실행되는 가장 작은 배포 단위

  - 일반적으로 하나의 컨테이너를 실행하지만 여러 컨테이너를 묶어서 실행

  - Pod은 동일한 네트워크 네임스페이스와 스토리지 볼륨을 공유하며, 서로 통신할 수 있습니다. 

  - 일반적으로 단일 프로세스를 실행하거나, **애플리케이션과 그에 대한 sidecar 컨테이너를 함께 실행하는 데 사용됩니다.**
- Container
  - 컨테이너는 애플리케이션을 패키징하고 실행하는 단위입니다. 
  - 컨테이너는 격리된 환경에서 실행되며, 필요한 모든 종속성을 포함하고 있어 이식성이 뛰어납니다. Kubernetes Pod 내에서 컨테이너를 실행하며, Docker 및 Containerd와 같은 컨테이너 런타임을 사용하여 컨테이너를 실행합니다.
- Label
  - Label은 Kubernetes 오브젝트에 부착되는 키-값 쌍입니다. Label을 사용하여 오브젝트를 그룹화하고 선택할 수 있으며, Pod와 같은 리소스를 식별하고 관리하는 데 사용됩니다. 예를 들어, 어떤 Pod들이 특정 작업을 수행하는지 식별하기 위해 Label을 사용할 수 있습니다.
- NodeSchedule
  - 노드 스케줄은 Pod를 실행할 적절한 노드를 선택하는 프로세스입니다. Kubernetes는 노드 스케줄러를 사용하여 어떤 노드에서 Pod를 실행할지 결정하며, 노드의 리소스 상태, Pod의 요구 사항 및 다른 정책을 고려합니다. 노드 스케줄링은 자동으로 이루어집니다.
    - 노드
      -  클러스터 내에서 컨테이너화된 애플리케이션을 실행하는 물리적 또는 가상의 컴퓨팅 리소스입니다. 
      -  각 노드는 클러스터에 속하며, CPU, 메모리, 네트워크 및 스토리지 리소스를 제공


#### Node, Pod, Container

노드, pod, 컨테이너의 관계 시각화

```
+-----------------------+     +-----------------------+
|       Node 1          |     |       Node 2          |
|                       |     |                       |
|  +--------------+     |     |  +--------------+     |
|  |    Pod A     |     |     |  |    Pod B     |     |
|  |  +---------+ |     |     |  |  +---------+ |     |
|  |  |Container| |     |     |  |  |Container| |     |
|  |  +---------+ |     |     |  |  +---------+ |     |
|  +--------------+     |     |  +--------------+     |
|                       |     |                       |
+-----------------------+     +-----------------------+

```

- "Node 1"과 "Node 2"는 Kubernetes 클러스터 내의 노드를 나타냅니다.
- 각 노드 내에는 하나 이상의 Pod (Pod A, Pod B)가 실행됩니다.
- 각 Pod 내에는 하나 이상의 컨테이너 (Container)가 있습니다. 컨테이너는 애플리케이션과 그 종속성을 패키징하고 실행하는 단위입니다.

Pod는 노드에서 실행되며, Pod 내에는 컨테이너가 있어 애플리케이션을 실행합니다. Kubernetes는 NodeScheduler와 같은 컨트롤러를 사용하여 어떤 Pod를 어떤 노드에 스케줄링할지 결정하며, 이를 통해 클러스터 리소스를 효율적으로 관리합니다.



### Service - ClusterIP, NodePort, LoadBalancer

- 컨테이너화된 애플리케이션을 네트워크로 노출하고, 다른 애플리케이션 또는 사용자가 해당 애플리케이션에 접근할 수 있도록 하는 추상화된 개념.
- 서비스는 클러스터 내부의 네트워크 트래픽을 관리하고, 애플리케이션의 고가용성 및 확장성을 제공

서비스는 일반적으로 다음과 같은 목적으로 사용됩니다:

1. **서비스 노출(Exposing Services):** 서비스를 사용하면 컨테이너나 Pod 내부에서 실행 중인 애플리케이션을 클러스터 외부로 노출할 수 있습니다. 이를 통해 외부 클라이언트(다른 서비스, 사용자 브라우저 등)가 애플리케이션에 접근할 수 있습니다.
   - 노출 방법은 서비스 유형에 따라 달리지며 ClusterIP, NodePort, LoadBalancer, ExternalName 등이 있습니다.
2. **로드 밸런싱(Load Balancing):** 서비스는 여러 개의 Pod 또는 컨테이너 중 하나로 요청을 분산하는 로드 밸런싱 기능을 제공합니다. 이로 인해 서비스에 대한 트래픽이 고르게 분배되며, 애플리케이션의 확장성이 향상됩니다.
3. **서비스 검색(Service Discovery):** 서비스는 Kubernetes 클러스터 내의 다른 애플리케이션이나 서비스가 특정 서비스를 찾고 통신할 때 사용할 수 있는 DNS(Domain Name System) 이름을 제공합니다. 이를 통해 서비스 간의 동적 통신이 가능하며, IP 주소 변경이나 Pod의 확장과 관련된 문제를 해결할 수 있습니다.
4. **애플리케이션 업데이트(Updating Applications):** 서비스를 사용하면 새로운 버전의 애플리케이션을 배포하거나 업데이트할 때 클라이언트가 기존 서비스와의 연결을 끊지 않고 새로운 Pod 또는 컨테이너로 전환할 수 있습니다.

서비스는 다양한 유형이 있으며, ClusterIP, NodePort, LoadBalancer, ExternalName 등이 있습니다. 각 서비스 유형은 서비스를 어떻게 노출할지와 어떻게 트래픽을 관리할지를 결정하는 다른 방식을 제공합니다. 이러한 서비스 유형을 사용하여 애플리케이션의 요구 사항과 클러스터 환경에 맞게 서비스를 구성할 수 있습니다.

- **ClusterIP (클러스터 내부 IP)**
  - ClusterIP 서비스는 Kubernetes 클러스터 내에서만 접근 가능한 가상 IP 주소를 제공합니다. **이 서비스는 주로 클러스터 내부의 마이크로서비스 간 통신을 위해 사용**됩니다.
    - 인가된 사용자 / 내부 대시보드 / Pod 의 서비스 상태 디버깅 위해 사용
  - 예를 들어, 여러 개의 백엔드 Pod가 클러스터 내에서 실행 중이고, 이를 외부에서 접근하지 않고 내부 서비스 간 통신만 필요하다면 ClusterIP 서비스를 사용하여 백엔드 서비스에 접근할 수 있습니다.
  - Pod 의 IP 를 쓰지 않는 이유는 Pod 은 언제든지 죽을 수 있고, 다시 생성될 때 IP는 변경될 수 있기 때문.
- **NodePort (노드 포트)**
  - NodePort 서비스는 클러스터의 **모든 노드에서 동일한 포트 번호로 서비스를 노출합니다.** 이 서비스를 사용하면 외부에서 노드의 IP 주소와 노드 포트 번호를 사용하여 서비스에 직접 접근할 수 있습니다.
    - 내부망 연결 / 데모나 임시 연결용
  - 예를 들어, 웹 애플리케이션을 노드 포트로 노출하면 클러스터 외부에서 해당 웹 애플리케이션에 접근할 수 있습니다. 이 방법은 개발 및 테스트 환경에서 유용할 수 있습니다.
- **LoadBalancer (로드 밸런서)**
  - LoadBalancer 서비스는 클라우드 제공업체의 로드 밸런서를 사용하여 서비스를 외부로 노출합니다. 이 서비스 유형은 외부 요청을 로드 밸런서로 라우팅하고, 로드 밸런서는 다중 백엔드 Pod 간에 부하 분산을 수행합니다.
    - 외부 시스템 노출용
  - 로드 밸런서 서비스는 고가용성 및 확장성을 제공하며, 공개 서비스나 웹 애플리케이션과 같이 외부에서 접근해야 하는 경우 유용합니다.

요약하면, ClusterIP은 클러스터 내부에서만 사용되며, 
NodePort는 클러스터 외부에서 직접 접근할 수 있게 하고, 
LoadBalancer는 클라우드 제공업체의 로드 밸런서를 사용하여 서비스를 공개적으로 노출합니다. 



### Volume - emptyDir, hostPath, PV/PVC 

- **Volume**
  - 컨테이너 내부 또는 컨테이너 간에 데이터를 공유하거나 저장하기 위한 추상적인 개
  - Volume을 사용하면 컨테이너 간에 데이터를 영구적으로 저장하고 공유할 수 있으며, 컨테이너의 수명 주기와 독립적으로 데이터를 유지할 수 있습니다. 



- **emptyDir:**
  - **설명:** `emptyDir`는 임시로 데이터를 저장하는 데 사용되는 Volume 유형입니다. 파드 내의 모든 컨테이너가 동일한 `emptyDir`를 마운트하면 데이터를 공유할 수 있습니다. 그러나 파드가 삭제되면 `emptyDir`에 저장된 데이터도 함께 소멸합니다.
  - **용도:** 임시 파일, 캐시 데이터 또는 컨테이너 간 데이터 공유 등의 용도로 사용될 수 있습니다.
- **hostPath:**
  - **설명:** `hostPath` Volume은 호스트 노드의 파일 시스템 경로를 파드에 마운트하여 사용하는 Volume입니다. 이렇게 하면 호스트 노드의 파일 시스템에 직접 액세스할 수 있지만, 호스트 노드 간에 이동되지 않으므로 이식성이 제한됩니다.
  - **용도:** 호스트 노드의 특정 파일이나 디렉터리에 액세스해야 하는 경우 또는 호스트 노드의 로그 파일을 파드 내부로 가져오는 등의 용도로 사용될 수 있습니다.
- **PV (Persistent Volume) 및 PVC (Persistent Volume Claim):**
  - **설명:** PV는 영구적으로 데이터를 저장하는 데 사용되며, 클러스터의 다양한 노드 간에 이동할 수 있는 Volume입니다. PV는 클러스터 관리자가 생성하고 설정하며, 사용자 또는 파드에서 이 PV에 액세스하기 위해 PVC를 생성하고 요청합니다. PVC는 PV의 일종으로 생각할 수 있으며, PV를 요청하고 사용자가 정의한 스토리지 클래스 및 용량과 같은 요구 사항을 제시합니다.
  - **용도:** 데이터베이스 스토리지, 파일 공유, 데이터 백업 등과 같이 영구적인 데이터 저장 및 공유에 사용됩니다.

### ConfigMap, Secret - Env, Mount 

ConfigMap은 설정 데이터를 저장하는 데 사용되며, Secret은 암호나 비밀 키와 같은 민감한 데이터를 안전하게 저장합니다. 이러한 정보를 컨테이너에 환경 변수로 주입하거나 파일 시스템에 마운트할 수 있습니다.



### Namespace, ResoujrceQuota, LimitRange 

- Namespace는 Kubernetes 클러스터 내에서 리소스를 분리하고 격리하기 위한 가상화된 클러스터를 생성합니다. 
- ResourceQuota는 네임스페이스 내의 리소스 사용량을 제한
- LimitRange는 컨테이너 리소스 제한을 정의합니다.

